import maas_cds.model as model


DUPLICATE_POINT_FOOTPRINT_JSON = {
        "type": "Polygon",
        "coordinates": [
            [
                [112.977859250783, 53.8505422963213],
                [112.977923929087, 53.8506581651138],
                [112.980973475963, 53.8499995189177],
                [112.980973475963, 53.8499995189177],  # duplicate
                [112.981033302966, 53.8501065566149],
                [112.987831852864, 53.848518235291],
                [112.987831852864, 53.848518235291],  # duplicate
                [112.993481522176, 53.8472980103357],
            ]
        ],
        "meta": {"srid": 4326},
    }

CROSSING_ANTEMERIDIAN_FOOTPRINT_JSON = {
        "type": "Polygon", "coordinates": [
            [
                [180.0, 56.202697832882],
				[179.87977316166, 56.2304687953485],
				[179.874174280373, 56.2316633344172],
				[179.874350513365, 56.2319424281784],
				[179.727332390941, 56.2632693647655],
				[179.520942097499, 56.3077252893756],
				[179.520679499835, 56.307303405661],
				[179.519543625835, 56.307545440127],
				[179.5194745236, 56.3074343431525],
				[179.49150635936, 56.313324721991],
				[179.491599094666, 56.3134742982868],
				[179.126676037347, 56.3902271285942],
				[179.126701072677, 56.3902680317574],
				[179.124863771389, 56.3906308476611],
				[179.124962394792, 56.3907920960414],
				[178.926284145036, 56.4298448007921],
				[178.777919603393, 56.4591426713197],
				[178.777846862329, 56.4590220126042],
				[178.775569464182, 56.4594696638067],
				[178.775549071469, 56.4594358052768],
				[178.389143639107, 56.533123795985],
				[178.385908504785, 56.5337083463675],
				[178.386297719379, 56.5343653171225],
				[178.037227921391, 56.5974682759006],
				[178.03712971013, 56.5972998483746],
				[178.033729088333, 56.5979143458799],
				[178.033473428484, 56.5974748695353],
				[178.02406228302, 56.5990896648335],
				[178.023526836271, 56.5991864137072],
				[177.927233595675, 56.6157038495419],
				[177.641284969985, 56.6647678554126],
				[177.641523277474, 56.6651841241588],
				[177.637349502281, 56.6658713394834],
				[177.637597230029, 56.6663045329877],
				[177.282683241608, 56.7249004718405],
				[177.282333985619, 56.724279446416],
				[177.281813586945, 56.7243653291818],
				[176.88168009999, 56.7854807745997],
				[176.882111790482, 56.7862629573461],
				[176.876580797037, 56.7870837402452],
				[176.87660122171, 56.7871207832905],
				[176.510593277478, 56.8419438977499],
				[176.510380724201, 56.8415514686009],
				[176.094931023153, 56.8972131938548],
				[176.095473573907, 56.8982360275632],
				[175.75973040304, 56.9425628905257],
				[175.693981226947, 56.9513601784339],
				[175.752952096896, 57.0649724111113],
				[175.82841146602, 57.2096434335756],
				[175.904371513787, 57.3543125350678],
				[175.980995603511, 57.4989010224348],
				[176.05794733179, 57.6434312435327],
				[176.135176598729, 57.7879475850259],
				[176.213132014446, 57.9323981863477],
				[176.291587764431, 58.0768320043553],
				[176.370626522323, 58.2212469338258],
				[176.450073569849, 58.3650637794677],
				[176.496599639061, 58.3590128360238],
				[176.588328215567, 58.3470227072716],
				[176.89167899297, 58.3065786695398],
				[176.891269638771, 58.3058531787727],
				[177.237147116674, 58.25962583438],
				[177.283029320943, 58.2534196875054],
				[177.283275475574, 58.253846887742],
				[177.283839178883, 58.2537714413122],
				[177.283991668256, 58.2540359891813],
				[177.393891791611, 58.2378731827391],
				[177.44228745722, 58.2307142325554],
				[177.705426204703, 58.1916093710813],
				[177.704962386571, 58.1908199677187],
				[177.705000963601, 58.1908141096172],
				[177.704951916756, 58.1907305885234],
				[178.077405482834, 58.1342354034631],
				[178.077464505914, 58.1343341430387],
				[178.08142828586, 58.1337276240398],
				[178.081469304441, 58.1337961204199],
				[178.08175180322, 58.1337531371705],
				[178.081884826991, 58.133975170298],
				[178.490619718399, 58.0669591516647],
				[178.490288511595, 58.0664160002694],
				[178.490326188813, 58.0664095769024],
				[178.490311270987, 58.0663850980322],
				[178.590193499964, 58.049361579725],
				[178.764715396823, 58.0195921586765],
				[178.857457158228, 58.0037514643275],
				[178.857650298564, 58.0040626335378],
				[179.260163556093, 57.9318046671992],
				[179.259931908096, 57.9314377781192],
				[179.619420463161, 57.8633753792912],
				[179.619442620269, 57.8634099276123],
				[179.619460508313, 57.8634065394422],
				[179.619469574034, 57.8634206827728],
				[179.61956666875, 57.863402307173],
				[179.619636441722, 57.8635109413486],
				[179.623058164543, 57.8628632297704],
				[179.623073013723, 57.8628863488604],
				[179.623395451562, 57.8628254450802],
				[179.623419244447, 57.862862500563],
				[-179.974556195488, 57.7842899291572],
				[-179.974846883315, 57.7838442468165],
				[-179.973738632153, 57.7836124642801],
				[-179.973754324441, 57.7835884534672],
				[-179.971011949256, 57.7830161155381],
				[-179.971025539562, 57.7829953138809],
				[-179.95004410446, 57.7786400940026],
				[-179.911875096515, 57.7706741631981],
				[-179.61400612661, 57.7083770704795],
				[-179.613929692262, 57.7084924979803],
				[-179.613760253304, 57.7084571358084],
				[-179.613731336592, 57.7085007221132],
				[-179.585085821913, 57.7025176576634],
				[-179.585148897874, 57.7024226067713],
				[-179.202551828778, 57.621299330656],
				[-179.202873595539, 57.6208215468502],
				[-179.198570802147, 57.61983291952],
				[-179.19880268925, 57.6194891686052],
				[-179.042436787691, 57.5839589326026],
				[-178.805543661001, 57.5295294032186],
				[-178.901577466618, 57.3894721053662],
				[-178.997988519794, 57.247580301176],
				[-179.093869102502, 57.105632030934],
				[-179.188877054134, 56.963598987631],
				[-179.2830592054, 56.8215105813016],
				[-179.376690381992, 56.6793968098982],
				[-179.469679694975, 56.5372024216103],
				[-179.562098965143, 56.3949294698784],
				[-179.65412438434, 56.2526141494245],
				[-179.72657545033, 56.1395400304216],
				[180.0, 56.202697832882]
            ]
        ], "meta": {"srid": 4326}
    }

def test_footprint_clean():
    cleaned_footprint_json = model.s2_tilpar_tiles.S2Tiles.remove_duplicate_points(
        DUPLICATE_POINT_FOOTPRINT_JSON
    )
    assert cleaned_footprint_json == {
        "type": "Polygon",
        "coordinates": [
            [
                [112.977859250783, 53.8505422963213],
                [112.977923929087, 53.8506581651138],
                [112.980973475963, 53.8499995189177],
                [112.981033302966, 53.8501065566149],
                [112.987831852864, 53.848518235291],
                [112.993481522176, 53.8472980103357],
            ]
        ],
        "meta": {"srid": 4326},
    }


def test_footprint_crossing_antemeridian():
    cross_antemeridian = model.s2_tilpar_tiles.S2Tiles.is_crossing_antemeridian(
        CROSSING_ANTEMERIDIAN_FOOTPRINT_JSON
    )
    assert cross_antemeridian


def test_correct_footprint_crossing_antemeridian():
    cross_antemeridian = CROSSING_ANTEMERIDIAN_FOOTPRINT_JSON.copy()
    model.s2_tilpar_tiles.S2Tiles.correct_polygon(
        cross_antemeridian
    )
    assert cross_antemeridian == {
        "type": "Polygon", 
        "coordinates": [
            [
                [-180.0, 56.202697832882],
				[-180.12022683834, 56.2304687953485],
				[-180.125825719627, 56.2316633344172],
				[-180.125649486635, 56.2319424281784],
				[-180.272667609059, 56.2632693647655],
				[-180.479057902501, 56.3077252893756],
				[-180.479320500165, 56.307303405661],
				[-180.480456374165, 56.307545440127],
				[-180.4805254764, 56.3074343431525],
				[-180.50849364064, 56.313324721991],
				[-180.508400905334, 56.3134742982868],
				[-180.873323962653, 56.3902271285942],
				[-180.873298927323, 56.3902680317574],
				[-180.875136228611, 56.3906308476611],
				[-180.875037605208, 56.3907920960414],
				[-181.073715854964, 56.4298448007921],
				[-181.222080396607, 56.4591426713197],
				[-181.222153137671, 56.4590220126042],
				[-181.224430535818, 56.4594696638067],
				[-181.224450928531, 56.4594358052768],
				[-181.610856360893, 56.533123795985],
				[-181.614091495215, 56.5337083463675],
				[-181.613702280621, 56.5343653171225],
				[-181.962772078609, 56.5974682759006],
				[-181.96287028987, 56.5972998483746],
				[-181.966270911667, 56.5979143458799],
				[-181.966526571516, 56.5974748695353],
				[-181.97593771698, 56.5990896648335],
				[-181.976473163729, 56.5991864137072],
				[-182.072766404325, 56.6157038495419],
				[-182.358715030015, 56.6647678554126],
				[-182.358476722526, 56.6651841241588],
				[-182.362650497719, 56.6658713394834],
				[-182.362402769971, 56.6663045329877],
				[-182.717316758392, 56.7249004718405],
				[-182.717666014381, 56.724279446416],
				[-182.718186413055, 56.7243653291818],
				[-183.11831990001, 56.7854807745997],
				[-183.117888209518, 56.7862629573461],
				[-183.123419202963, 56.7870837402452],
				[-183.12339877829, 56.7871207832905],
				[-183.489406722522, 56.8419438977499],
				[-183.489619275799, 56.8415514686009],
				[-183.905068976847, 56.8972131938548],
				[-183.904526426093, 56.8982360275632],
				[-184.24026959696, 56.9425628905257],
				[-184.306018773053, 56.9513601784339],
				[-184.247047903104, 57.0649724111113],
				[-184.17158853398, 57.2096434335756],
				[-184.095628486213, 57.3543125350678],
				[-184.019004396489, 57.4989010224348],
				[-183.94205266821, 57.6434312435327],
				[-183.864823401271, 57.7879475850259],
				[-183.786867985554, 57.9323981863477],
				[-183.708412235569, 58.0768320043553],
				[-183.629373477677, 58.2212469338258],
				[-183.549926430151, 58.3650637794677],
				[-183.503400360939, 58.3590128360238],
				[-183.411671784433, 58.3470227072716],
				[-183.10832100703, 58.3065786695398],
				[-183.108730361229, 58.3058531787727],
				[-182.762852883326, 58.25962583438],
				[-182.716970679057, 58.2534196875054],
				[-182.716724524426, 58.253846887742],
				[-182.716160821117, 58.2537714413122],
				[-182.716008331744, 58.2540359891813],
				[-182.606108208389, 58.2378731827391],
				[-182.55771254278, 58.2307142325554],
				[-182.294573795297, 58.1916093710813],
				[-182.295037613429, 58.1908199677187],
				[-182.294999036399, 58.1908141096172],
				[-182.295048083244, 58.1907305885234],
				[-181.922594517166, 58.1342354034631],
				[-181.922535494086, 58.1343341430387],
				[-181.91857171414, 58.1337276240398],
				[-181.918530695559, 58.1337961204199],
				[-181.91824819678, 58.1337531371705],
				[-181.918115173009, 58.133975170298],
				[-181.509380281601, 58.0669591516647],
				[-181.509711488405, 58.0664160002694],
				[-181.509673811187, 58.0664095769024],
				[-181.509688729013, 58.0663850980322],
				[-181.409806500036, 58.049361579725],
				[-181.235284603177, 58.0195921586765],
				[-181.142542841772, 58.0037514643275],
				[-181.142349701436, 58.0040626335378],
				[-180.739836443907, 57.9318046671992],
				[-180.740068091904, 57.9314377781192],
				[-180.380579536839, 57.8633753792912],
				[-180.380557379731, 57.8634099276123],
				[-180.380539491687, 57.8634065394422],
				[-180.380530425966, 57.8634206827728],
				[-180.38043333125, 57.863402307173],
				[-180.380363558278, 57.8635109413486],
				[-180.376941835457, 57.8628632297704],
				[-180.376926986277, 57.8628863488604],
				[-180.376604548438, 57.8628254450802],
				[-180.376580755553, 57.862862500563],
				[-179.974556195488, 57.7842899291572],
				[-179.974846883315, 57.7838442468165],
				[-179.973738632153, 57.7836124642801],
				[-179.973754324441, 57.7835884534672],
				[-179.971011949256, 57.7830161155381],
				[-179.971025539562, 57.7829953138809],
				[-179.95004410446, 57.7786400940026],
				[-179.911875096515, 57.7706741631981],
				[-179.61400612661, 57.7083770704795],
				[-179.613929692262, 57.7084924979803],
				[-179.613760253304, 57.7084571358084],
				[-179.613731336592, 57.7085007221132],
				[-179.585085821913, 57.7025176576634],
				[-179.585148897874, 57.7024226067713],
				[-179.202551828778, 57.621299330656],
				[-179.202873595539, 57.6208215468502],
				[-179.198570802147, 57.61983291952],
				[-179.19880268925, 57.6194891686052],
				[-179.042436787691, 57.5839589326026],
				[-178.805543661001, 57.5295294032186],
				[-178.901577466618, 57.3894721053662],
				[-178.997988519794, 57.247580301176],
				[-179.093869102502, 57.105632030934],
				[-179.188877054134, 56.963598987631],
				[-179.2830592054, 56.8215105813016],
				[-179.376690381992, 56.6793968098982],
				[-179.469679694975, 56.5372024216103],
				[-179.562098965143, 56.3949294698784],
				[-179.65412438434, 56.2526141494245],
				[-179.72657545033, 56.1395400304216],
				[-180.0, 56.202697832882]
            ]
        ], 
        "meta": {"srid": 4326}
    }
